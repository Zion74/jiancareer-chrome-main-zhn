# AutoFill Pro 集成功能使用说明

## 概述

本项目已成功集成了轻量 MVP 项目的三大核心功能：
1. **轻交互浮窗 + 握手协议**
2. **统一本地键位存储**
3. **独立字段映射文件（热改功能）**

## 🚀 核心功能

### 1. 轻交互浮窗

#### 功能特性
- 页面内浮窗显示当前站点状态
- 提供「检测表单」、「一键填写」、「提交已记录」等操作
- 实时显示检测到的表单数量
- 支持拖拽移动浮窗位置
- 自动隐藏/显示机制

#### 使用方法
1. 访问任意包含表单的网页
2. 浮窗会自动出现在页面右下角
3. 点击「检测表单」按钮扫描页面表单
4. 选择用户档案后点击「一键填写」
5. 填写完成后可点击「提交已记录」保存投递记录

### 2. 握手协议

#### 消息类型
- `HANDSHAKE`: 建立连接握手
- `DETECT_FORMS`: 检测页面表单
- `FILL_FORMS`: 填写表单数据
- `GET_FORM_INFO`: 获取表单信息
- `RECORD_APPLICATION`: 记录投递信息

#### 通信流程
```
Popup ↔ Background ↔ Content Script
  ↓         ↓           ↓
握手建立 → 消息转发 → 页面操作
```

### 3. 统一本地键位

#### 存储键位
- `sj_profile`: 用户档案数据
- `sj_applications`: 投递记录数据

#### 数据结构
```javascript
// 用户档案
sj_profile = {
  firstName: "张",
  lastName: "三",
  email: "zhangsan@example.com",
  phone: "13800138000",
  wechat: "zhangsan_wx",
  // ... 更多字段
}

// 投递记录
sj_applications = [
  {
    id: "unique_id",
    company: "字节跳动",
    position: "前端开发工程师",
    status: "applied",
    appliedAt: "2024-01-15T10:30:00Z",
    // ... 更多字段
  }
]
```

### 4. 独立字段映射（热改功能）

#### 文件位置
- `formFieldMappings.js` - 独立映射文件，无需重构建即可修改

#### 支持的中文字段
- 基本信息：姓名、邮箱、手机、地址
- 社交账号：微信、QQ、LinkedIn、GitHub
- 教育信息：毕业时间、GPA
- 其他：作品集、个人网站等

#### 热改示例
```javascript
// 直接修改 formFieldMappings.js 文件
window.__SJ_FIELD_MAPPINGS__.newField = [
  { name: 'newField' },
  { placeholder: /新字段/i }
];
// 刷新页面即可生效，无需重新构建
```

## 📋 测试页面

项目提供了多个测试页面验证功能：

### 1. 握手协议测试
- `handshake-test.html` - 完整握手协议测试
- `basic-handshake-test.html` - 基础通信测试

### 2. 存储功能测试
- `storage-test.html` - 统一键位存储测试

### 3. 中文字段测试
- `chinese-fields-test.html` - 中文字段识别和填充测试

### 4. 投递记录测试
- `application-test.html` - 投递记录管理功能测试

## 🔧 开发指南

### 项目结构
```
Simplify/
├── src/                    # 源码目录
│   ├── background/         # 后台脚本
│   ├── content/           # 内容脚本
│   ├── popup/             # 弹窗页面
│   └── lib/               # 工具库
├── dist/                  # 构建产物
├── formFieldMappings.js   # 独立字段映射（热改）
├── manifest.json          # 扩展清单
└── *.html                 # 测试页面
```

### 构建流程
```bash
# 安装依赖
npm install

# 开发构建
npm run dev

# 生产构建
npm run build

# 启动测试服务器
npx http-server -p 8080
```

### 扩展安装
1. 打开 Chrome 扩展管理页面 `chrome://extensions/`
2. 开启「开发者模式」
3. 点击「加载已解压的扩展程序」
4. 选择项目根目录（包含 manifest.json）

## 🎯 使用场景

### 求职投递场景
1. **访问招聘网站**：打开任意招聘平台
2. **检测表单**：浮窗自动检测页面表单
3. **选择档案**：从弹窗中选择合适的用户档案
4. **一键填写**：自动填充所有识别的字段
5. **记录投递**：提交后自动记录投递信息
6. **管理记录**：通过弹窗查看和管理投递历史

### 字段映射自定义
1. **识别新字段**：发现网站使用了新的字段名称
2. **修改映射文件**：编辑 `formFieldMappings.js`
3. **添加规则**：增加新的字段识别规则
4. **即时生效**：刷新页面即可使用新规则

## 🔍 故障排除

### 常见问题

#### 1. 浮窗不显示
- 检查扩展是否正确安装和启用
- 确认页面包含表单元素
- 查看浏览器控制台是否有错误信息

#### 2. 字段识别失败
- 检查 `formFieldMappings.js` 文件是否正确加载
- 验证字段映射规则是否匹配目标字段
- 使用开发者工具检查表单元素属性

#### 3. 数据存储问题
- 确认扩展有存储权限
- 检查 `chrome.storage.local` 是否可用
- 验证数据格式是否正确

#### 4. 握手协议失败
- 检查所有脚本是否正确加载
- 验证消息监听器是否正确设置
- 查看后台脚本控制台错误信息

### 调试工具

#### 1. 扩展调试
```javascript
// 在控制台中检查扩展状态
chrome.runtime.sendMessage({type: 'PING'}, response => {
  console.log('扩展响应:', response);
});
```

#### 2. 存储调试
```javascript
// 查看存储数据
chrome.storage.local.get(['sj_profile', 'sj_applications'], result => {
  console.log('存储数据:', result);
});
```

#### 3. 字段映射调试
```javascript
// 检查字段映射
console.log('字段映射:', window.__SJ_FIELD_MAPPINGS__);
```

## 📈 性能优化

### 1. 字段检测优化
- 使用缓存避免重复检测
- 优化选择器性能
- 减少 DOM 查询次数

### 2. 存储优化
- 批量存储操作
- 数据压缩存储
- 定期清理过期数据

### 3. 消息传递优化
- 减少不必要的消息
- 使用消息队列
- 实现消息去重

## 🔄 版本兼容性

### 数据迁移
- 自动检测旧版本数据
- 一次性迁移到新键位
- 保持向后兼容性

### 功能兼容
- 渐进式功能增强
- 优雅降级处理
- 错误恢复机制

## 📝 更新日志

### v2.0.0 (当前版本)
- ✅ 集成轻交互浮窗功能
- ✅ 实现握手协议通信
- ✅ 统一本地键位存储
- ✅ 独立字段映射热改
- ✅ 完整中文字段支持
- ✅ 投递记录管理功能

### 计划功能
- 🔄 表单自动提交
- 🔄 批量投递管理
- 🔄 数据导入导出
- 🔄 云端数据同步

## 🤝 贡献指南

### 开发环境
1. Node.js >= 16
2. Chrome/Edge 浏览器
3. VS Code（推荐）

### 代码规范
- TypeScript 严格模式
- ESLint + Prettier
- 组件化开发
- 单元测试覆盖

### 提交规范
```
feat: 新功能
fix: 修复问题
docs: 文档更新
style: 代码格式
refactor: 重构代码
test: 测试相关
chore: 构建配置
```

---

## 📞 技术支持

如遇到问题或需要技术支持，请：
1. 查看本文档的故障排除部分
2. 使用提供的测试页面验证功能
3. 检查浏览器控制台错误信息
4. 提供详细的问题描述和复现步骤

**项目集成完成！所有核心功能已验证可用。** 🎉