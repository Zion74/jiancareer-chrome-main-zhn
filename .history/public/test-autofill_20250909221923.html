<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€é”®å¡«å…¥åŠŸèƒ½æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .test-section h3 {
            color: #555;
            margin-top: 0;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a87;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .form-section {
            background: white;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 80px;
            resize: vertical;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ä¸€é”®å¡«å…¥åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
        
        <div class="test-section">
            <h3>ğŸ”§ ç¯å¢ƒæ£€æµ‹</h3>
            <button onclick="checkEnvironment()">æ£€æµ‹ç¯å¢ƒ</button>
            <button onclick="checkContentScript()">æ£€æµ‹Content Script</button>
            <button onclick="testMessageCommunication()">æµ‹è¯•æ¶ˆæ¯é€šä¿¡</button>
            <div id="env-status"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•</h3>
            <button onclick="setTestData()">è®¾ç½®æµ‹è¯•æ•°æ®</button>
            <button onclick="clearTestData()">æ¸…é™¤æ•°æ®</button>
            <button onclick="showCurrentData()">æ˜¾ç¤ºå½“å‰æ•°æ®</button>
            <div id="data-status"></div>
        </div>

        <div class="test-section">
            <h3>ğŸš€ è‡ªåŠ¨å¡«å†™æµ‹è¯•</h3>
            <button onclick="testAutofill()">æµ‹è¯•è‡ªåŠ¨å¡«å†™</button>
            <button onclick="clearForm()">æ¸…ç©ºè¡¨å•</button>
            <div id="autofill-status"></div>
        </div>

        <div class="form-section">
            <h3>ğŸ“‹ æµ‹è¯•è¡¨å•</h3>
            <form id="test-form">
                <div class="form-group">
                    <label for="name">å§“å:</label>
                    <input type="text" id="name" name="name" placeholder="è¯·è¾“å…¥å§“å">
                </div>
                
                <div class="form-group">
                    <label for="phone">ç”µè¯:</label>
                    <input type="tel" id="phone" name="phone" placeholder="è¯·è¾“å…¥ç”µè¯å·ç ">
                </div>
                
                <div class="form-group">
                    <label for="email">é‚®ç®±:</label>
                    <input type="email" id="email" name="email" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€">
                </div>
                
                <div class="form-group">
                    <label for="experience">å·¥ä½œç»éªŒ:</label>
                    <select id="experience" name="experience">
                        <option value="">è¯·é€‰æ‹©å·¥ä½œç»éªŒ</option>
                        <option value="0-1å¹´">0-1å¹´</option>
                        <option value="1-3å¹´">1-3å¹´</option>
                        <option value="3-5å¹´">3-5å¹´</option>
                        <option value="5-10å¹´">5-10å¹´</option>
                        <option value="10å¹´ä»¥ä¸Š">10å¹´ä»¥ä¸Š</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="education">å­¦å†:</label>
                    <select id="education" name="education">
                        <option value="">è¯·é€‰æ‹©å­¦å†</option>
                        <option value="é«˜ä¸­">é«˜ä¸­</option>
                        <option value="å¤§ä¸“">å¤§ä¸“</option>
                        <option value="æœ¬ç§‘">æœ¬ç§‘</option>
                        <option value="ç¡•å£«">ç¡•å£«</option>
                        <option value="åšå£«">åšå£«</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="salary">æœŸæœ›è–ªèµ„:</label>
                    <input type="text" id="salary" name="salary" placeholder="è¯·è¾“å…¥æœŸæœ›è–ªèµ„">
                </div>
                
                <div class="form-group">
                    <label for="skills">æŠ€èƒ½:</label>
                    <textarea id="skills" name="skills" placeholder="è¯·è¾“å…¥æ‚¨çš„æŠ€èƒ½"></textarea>
                </div>
            </form>
        </div>

        <div class="log" id="log"></div>
    </div>

    <script>
        let logElement = document.getElementById('log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : type === 'warning' ? '#ff0' : '#0ff';
            logElement.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // ç¯å¢ƒæ£€æµ‹
        function checkEnvironment() {
            log('å¼€å§‹ç¯å¢ƒæ£€æµ‹...');
            
            // æ£€æµ‹Chromeæ‰©å±•API
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                log('âœ“ Chromeæ‰©å±•APIå¯ç”¨', 'success');
                showStatus('env-status', 'Chromeæ‰©å±•ç¯å¢ƒæ­£å¸¸', 'success');
            } else {
                log('âœ— Chromeæ‰©å±•APIä¸å¯ç”¨', 'error');
                showStatus('env-status', 'Chromeæ‰©å±•ç¯å¢ƒå¼‚å¸¸', 'error');
            }
            
            // æ£€æµ‹é¡µé¢URL
            log(`å½“å‰é¡µé¢: ${window.location.href}`);
            
            // æ£€æµ‹è¡¨å•å…ƒç´ 
            const form = document.getElementById('test-form');
            if (form) {
                const inputs = form.querySelectorAll('input, select, textarea');
                log(`âœ“ æ£€æµ‹åˆ° ${inputs.length} ä¸ªè¡¨å•å­—æ®µ`, 'success');
            }
        }
        
        // æ£€æµ‹Content Script
        function checkContentScript() {
            log('æ£€æµ‹Content Scriptæ³¨å…¥çŠ¶æ€...');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰JianCareerContentScript
            if (window.jianCareerContentScript) {
                log('âœ“ Content Scriptå·²æ³¨å…¥', 'success');
                showStatus('env-status', 'Content Scriptæ­£å¸¸', 'success');
            } else {
                log('âœ— Content Scriptæœªæ³¨å…¥', 'error');
                showStatus('env-status', 'Content Scriptæœªæ³¨å…¥', 'error');
            }
        }
        
        // æµ‹è¯•æ¶ˆæ¯é€šä¿¡
        function testMessageCommunication() {
            log('æµ‹è¯•æ¶ˆæ¯é€šä¿¡...');
            
            // å‘é€æµ‹è¯•æ¶ˆæ¯
            window.postMessage({
                type: 'JC_TEST_MESSAGE',
                source: 'test-page',
                data: { test: true }
            }, '*');
            
            log('å·²å‘é€æµ‹è¯•æ¶ˆæ¯');
        }
        
        // è®¾ç½®æµ‹è¯•æ•°æ®
        function setTestData() {
            const testData = {
                name: 'å¼ ä¸‰',
                phone: '13800138000',
                email: 'zhangsan@example.com',
                experience: '3-5å¹´',
                education: 'æœ¬ç§‘',
                salary: '10-15K',
                skills: 'JavaScript, React, Node.js, Python'
            };
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('test-profile-data', JSON.stringify(testData));
            
            log('æµ‹è¯•æ•°æ®å·²è®¾ç½®:', 'success');
            log(JSON.stringify(testData, null, 2));
            showStatus('data-status', 'æµ‹è¯•æ•°æ®å·²è®¾ç½®', 'success');
        }
        
        // æ¸…é™¤æµ‹è¯•æ•°æ®
        function clearTestData() {
            localStorage.removeItem('test-profile-data');
            log('æµ‹è¯•æ•°æ®å·²æ¸…é™¤', 'success');
            showStatus('data-status', 'æµ‹è¯•æ•°æ®å·²æ¸…é™¤', 'success');
        }
        
        // æ˜¾ç¤ºå½“å‰æ•°æ®
        function showCurrentData() {
            const data = localStorage.getItem('test-profile-data');
            if (data) {
                log('å½“å‰æ•°æ®:');
                log(data);
                showStatus('data-status', 'æ•°æ®å·²æ˜¾ç¤ºåœ¨æ—¥å¿—ä¸­', 'info');
            } else {
                log('æ²¡æœ‰æ‰¾åˆ°æ•°æ®', 'warning');
                showStatus('data-status', 'æ²¡æœ‰æ•°æ®', 'warning');
            }
        }
        
        // æµ‹è¯•è‡ªåŠ¨å¡«å†™
        function testAutofill() {
            log('å¼€å§‹æµ‹è¯•è‡ªåŠ¨å¡«å†™...');
            
            const testData = localStorage.getItem('test-profile-data');
            if (!testData) {
                log('è¯·å…ˆè®¾ç½®æµ‹è¯•æ•°æ®', 'error');
                showStatus('autofill-status', 'è¯·å…ˆè®¾ç½®æµ‹è¯•æ•°æ®', 'error');
                return;
            }
            
            const data = JSON.parse(testData);
            
            // æ¨¡æ‹Ÿè‡ªåŠ¨å¡«å†™
            try {
                document.getElementById('name').value = data.name || '';
                document.getElementById('phone').value = data.phone || '';
                document.getElementById('email').value = data.email || '';
                document.getElementById('experience').value = data.experience || '';
                document.getElementById('education').value = data.education || '';
                document.getElementById('salary').value = data.salary || '';
                document.getElementById('skills').value = data.skills || '';
                
                log('è¡¨å•å¡«å†™å®Œæˆ', 'success');
                showStatus('autofill-status', 'è‡ªåŠ¨å¡«å†™æˆåŠŸ', 'success');
            } catch (error) {
                log('å¡«å†™å¤±è´¥: ' + error.message, 'error');
                showStatus('autofill-status', 'è‡ªåŠ¨å¡«å†™å¤±è´¥', 'error');
            }
        }
        
        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            const form = document.getElementById('test-form');
            form.reset();
            log('è¡¨å•å·²æ¸…ç©º', 'success');
            showStatus('autofill-status', 'è¡¨å•å·²æ¸…ç©º', 'info');
        }
        
        // ç›‘å¬æ¶ˆæ¯
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type) {
                log(`æ”¶åˆ°æ¶ˆæ¯: ${event.data.type}`);
                log(JSON.stringify(event.data, null, 2));
            }
        });
        
        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
            log('è¯·æŒ‰é¡ºåºæ‰§è¡Œæµ‹è¯•æ­¥éª¤:');
            log('1. æ£€æµ‹ç¯å¢ƒ');
            log('2. è®¾ç½®æµ‹è¯•æ•°æ®');
            log('3. æµ‹è¯•è‡ªåŠ¨å¡«å†™');
        });
    </script>
</body>
</html>