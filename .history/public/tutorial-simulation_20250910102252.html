<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>简历助手 - 教学演示与岗位模拟</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .content {
        padding: 30px;
      }

      /* 教学说明区域样式 */
      .tutorial-section {
        margin-bottom: 40px;
      }

      .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .steps-container,
      .tips-container {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid #667eea;
      }

      .step-item,
      .tip-item {
        margin-bottom: 15px;
        padding: 10px;
        background: white;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .step-number {
        display: inline-block;
        width: 24px;
        height: 24px;
        background: #667eea;
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 24px;
        font-size: 12px;
        font-weight: bold;
        margin-right: 10px;
      }

      /* 状态指示器样式 */
      .status-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      .status-indicator {
        padding: 15px;
        border-radius: 8px;
        border: 2px solid #ddd;
        background: #f5f5f5;
        text-align: center;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .profile-summary {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .completion-bar {
        background: #e9ecef;
        border-radius: 10px;
        height: 20px;
        margin: 10px 0;
        overflow: hidden;
      }

      .completion-fill {
        background: linear-gradient(90deg, #52c41a, #73d13d);
        height: 100%;
        border-radius: 10px;
        transition: width 0.3s ease;
        width: 0%;
      }

      /* 岗位信息样式 */
      .job-info {
        background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
        color: white;
        padding: 25px;
        border-radius: 8px;
        margin-bottom: 30px;
      }

      .job-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .job-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      .job-detail-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px 15px;
        border-radius: 6px;
        backdrop-filter: blur(10px);
      }

      /* 表单样式 */
      .form-section {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 30px;
        margin-top: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #2c3e50;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e1e8ed;
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      textarea {
        resize: vertical;
        min-height: 100px;
      }

      .demo-button {
        background: linear-gradient(135deg, #52c41a 0%, #389e0d 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 20px;
        width: 100%;
        transition: all 0.3s ease;
      }

      .demo-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(82, 196, 26, 0.3);
      }

      .submit-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
      }

      .success-message {
        display: none;
        background: linear-gradient(135deg, #52c41a 0%, #389e0d 100%);
        color: white;
        padding: 30px;
        border-radius: 8px;
        text-align: center;
        margin-top: 20px;
      }

      .success-message h3 {
        font-size: 1.5rem;
        margin-bottom: 10px;
      }

      /* 动画效果 */
      .highlight-field {
        animation: highlightPulse 1s ease-in-out;
      }

      @keyframes highlightPulse {
        0% {
          background-color: #fff;
        }
        50% {
          background-color: #f6ffed;
          border-color: #52c41a;
        }
        100% {
          background-color: #f6ffed;
          border-color: #52c41a;
        }
      }

      .loading {
        opacity: 0.7;
        pointer-events: none;
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
        }

        .status-section {
          grid-template-columns: 1fr;
        }

        .job-details {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>🚀 简历助手教学演示</h1>
        <p>学习如何使用简历助手插件，并体验真实的岗位申请流程</p>
      </div>

      <div class="content">
        <!-- 教学说明区域 -->
        <div class="tutorial-section">
          <h2 class="section-title">📋 使用步骤</h2>
          <div class="steps-container">
            <div class="step-item">
              <span class="step-number">1</span>
              <strong>安装插件：</strong>确保已安装简历助手浏览器插件
            </div>
            <div class="step-item">
              <span class="step-number">2</span>
              <strong>检查连接：</strong
              >查看下方插件状态指示器，确认插件已正常连接
            </div>
            <div class="step-item">
              <span class="step-number">3</span>
              <strong>查看档案：</strong
              >如果已有档案数据，会在下方显示档案摘要和完成度
            </div>
            <div class="step-item">
              <span class="step-number">4</span>
              <strong>体验填写：</strong
              >点击"开始自动填写演示"按钮，体验一键填写功能
            </div>
            <div class="step-item">
              <span class="step-number">5</span>
              <strong>提交申请：</strong>填写完成后，点击提交按钮完成岗位申请
            </div>
          </div>

          <h2 class="section-title">💡 使用提示</h2>
          <div class="tips-container">
            <div class="tip-item">
              <strong>🔌 插件状态：</strong
              >如果插件状态显示未连接，请刷新页面或重新安装插件
            </div>
            <div class="tip-item">
              <strong>📊 档案完成度：</strong
              >完成度越高，自动填写的信息越完整和准确
            </div>
            <div class="tip-item">
              <strong>🎯 演示模式：</strong
              >如果没有档案数据，系统会使用演示数据进行填写展示
            </div>
            <div class="tip-item">
              <strong>✨ 字段高亮：</strong>自动填写时，被填充的字段会有高亮效果
            </div>
          </div>

          <!-- 状态指示器区域 -->
          <div class="status-section">
            <div id="statusIndicator" class="status-indicator">
              🔍 正在检测插件状态...
            </div>
            <div id="extension-status" class="status-indicator">
              🔍 正在检测扩展...
            </div>
          </div>

          <!-- 档案摘要区域 -->
          <div
            id="profileSummary"
            class="profile-summary"
            style="display: none"
          >
            <h3>📋 档案信息摘要</h3>
            <div id="profileContent"></div>
            <div class="completion-bar">
              <div id="completionFill" class="completion-fill"></div>
            </div>
            <p id="completionText">档案完成度: 0%</p>
          </div>
        </div>

        <!-- 岗位信息区域 -->
        <div class="job-info">
          <div class="job-title">🏢 腾讯科技 - 前端开发工程师</div>
          <p>📍 深圳市南山区 | 💰 15k-30k | 📅 全职 | 🎓 本科及以上</p>
          <div class="job-details">
            <div class="job-detail-item">
              <strong>技能要求：</strong>JavaScript, React, Vue, Node.js
            </div>
            <div class="job-detail-item">
              <strong>工作经验：</strong>1-3年相关经验
            </div>
            <div class="job-detail-item">
              <strong>学历要求：</strong>本科及以上学历
            </div>
            <div class="job-detail-item">
              <strong>工作地点：</strong>深圳市南山区科技园
            </div>
          </div>
        </div>

        <!-- 表单区域 -->
        <div class="form-section">
          <button
            id="demo-button"
            class="demo-button"
            onclick="startFormFillingDemo()"
          >
            🎯 开始自动填写演示
          </button>

          <form id="job-application-form">
            <h3 style="margin-bottom: 20px; color: #2c3e50">📝 岗位申请表</h3>

            <!-- 基本信息 -->
            <div class="form-group">
              <h4 style="margin-bottom: 15px; color: #667eea">👤 基本信息</h4>
              <div class="form-row">
                <div>
                  <label for="name">姓名 *</label>
                  <input type="text" id="name" name="name" required />
                </div>
                <div>
                  <label for="email">邮箱 *</label>
                  <input type="email" id="email" name="email" required />
                </div>
              </div>
              <div class="form-row">
                <div>
                  <label for="phone">手机号 *</label>
                  <input type="tel" id="phone" name="phone" required />
                </div>
                <div>
                  <label for="age">年龄</label>
                  <input type="number" id="age" name="age" min="18" max="65" />
                </div>
              </div>
            </div>

            <!-- 教育背景 -->
            <div class="form-group">
              <h4 style="margin-bottom: 15px; color: #667eea">🎓 教育背景</h4>
              <div class="form-row">
                <div>
                  <label for="education">学历 *</label>
                  <select id="education" name="education" required>
                    <option value="">请选择学历</option>
                    <option value="高中">高中</option>
                    <option value="大专">大专</option>
                    <option value="本科">本科</option>
                    <option value="硕士">硕士</option>
                    <option value="博士">博士</option>
                  </select>
                </div>
                <div>
                  <label for="graduationYear">毕业年份</label>
                  <input
                    type="number"
                    id="graduationYear"
                    name="graduationYear"
                    min="1990"
                    max="2030"
                  />
                </div>
              </div>
              <div class="form-row">
                <div>
                  <label for="school">毕业院校</label>
                  <input type="text" id="school" name="school" />
                </div>
                <div>
                  <label for="major">专业</label>
                  <input type="text" id="major" name="major" />
                </div>
              </div>
            </div>

            <!-- 工作经验 -->
            <div class="form-group">
              <h4 style="margin-bottom: 15px; color: #667eea">💼 工作经验</h4>
              <div class="form-row">
                <div>
                  <label for="experience">工作年限</label>
                  <select id="experience" name="experience">
                    <option value="">请选择工作年限</option>
                    <option value="应届毕业生">应届毕业生</option>
                    <option value="1年以下">1年以下</option>
                    <option value="1-3年">1-3年</option>
                    <option value="3-5年">3-5年</option>
                    <option value="5-10年">5-10年</option>
                    <option value="10年以上">10年以上</option>
                  </select>
                </div>
                <div>
                  <label for="currentCompany">当前/最近公司</label>
                  <input
                    type="text"
                    id="currentCompany"
                    name="currentCompany"
                  />
                </div>
              </div>
            </div>

            <!-- 项目经验 -->
            <div class="form-group">
              <h4 style="margin-bottom: 15px; color: #667eea">🚀 项目经验</h4>
              <div>
                <label for="projectExperience">主要项目经验</label>
                <textarea
                  id="projectExperience"
                  name="projectExperience"
                  placeholder="请描述您的主要项目经验，包括项目名称、技术栈、您的职责等..."
                ></textarea>
              </div>
            </div>

            <!-- 技能标签 -->
            <div class="form-group">
              <h4 style="margin-bottom: 15px; color: #667eea">🛠️ 技能标签</h4>
              <div>
                <label for="skills">技能关键词</label>
                <input
                  type="text"
                  id="skills"
                  name="skills"
                  placeholder="如：JavaScript, React, Vue, Node.js, Python 等"
                />
              </div>
            </div>

            <!-- 求职意向 -->
            <div class="form-group">
              <h4 style="margin-bottom: 15px; color: #667eea">🎯 求职意向</h4>
              <div class="form-row">
                <div>
                  <label for="targetPosition">期望职位</label>
                  <input
                    type="text"
                    id="targetPosition"
                    name="targetPosition"
                  />
                </div>
                <div>
                  <label for="targetSalary">期望薪资</label>
                  <input
                    type="text"
                    id="targetSalary"
                    name="targetSalary"
                    placeholder="如：10k-15k"
                  />
                </div>
              </div>
              <div>
                <label for="targetCity">期望工作城市</label>
                <input type="text" id="targetCity" name="targetCity" />
              </div>
            </div>

            <!-- 自我介绍 -->
            <div class="form-group">
              <h4 style="margin-bottom: 15px; color: #667eea">📝 自我介绍</h4>
              <div>
                <label for="selfIntroduction">自我介绍</label>
                <textarea
                  id="selfIntroduction"
                  name="selfIntroduction"
                  placeholder="请简要介绍您的个人背景、技能特长、职业规划等..."
                ></textarea>
              </div>
            </div>

            <button type="submit" class="submit-btn">🚀 提交申请</button>
          </form>

          <!-- 成功消息 -->
          <div id="success-message" class="success-message">
            <h3>🎉 申请提交成功！</h3>
            <p>感谢您的申请，我们会在3个工作日内与您联系。</p>
            <p>请保持手机畅通，注意查收邮件。</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 引入脚本 -->
    <!-- <script src="js/extension-handshake.js"></script> -->
    <!-- <script src="js/state-manager.js"></script> -->
    <!-- <script src="js/auth.js"></script> -->

    <script>
      // 全局变量
      let extensionDetected = false;
      let profileData = null;
      let tutorialManager = null;

      // TutorialManager 类
      class TutorialManager {
        constructor() {
          this.profileData = null;
          this.completionPercentage = 0;
          this.init();
        }

        async init() {
          console.log("初始化教程管理器");
          await this.checkPluginStatus();
          await this.loadProfileData();
          this.updateUI();
        }

        async checkPluginStatus() {
          const statusIndicator = document.getElementById("statusIndicator");

          try {
            // 模拟插件检测
            statusIndicator.textContent = "🔍 正在检测插件...";
            statusIndicator.style.background = "#ffa940";
            statusIndicator.style.borderColor = "#fa8c16";

            await new Promise((resolve) => setTimeout(resolve, 1000));

            // 检查是否有 sj_profile 数据
            if (localStorage.getItem("sj_profile")) {
              statusIndicator.textContent = "✅ 插件已连接";
              statusIndicator.style.background = "#52c41a";
              statusIndicator.style.borderColor = "#389e0d";
            } else {
              statusIndicator.textContent = "⚠️ 插件未检测到档案数据";
              statusIndicator.style.background = "#faad14";
              statusIndicator.style.borderColor = "#d48806";
            }
          } catch (error) {
            console.error("插件检测失败:", error);
            statusIndicator.textContent = "❌ 插件检测失败";
            statusIndicator.style.background = "#ff4d4f";
            statusIndicator.style.borderColor = "#cf1322";
          }
        }

        async loadProfileData() {
          try {
            const profileJson = localStorage.getItem("sj_profile");
            if (profileJson) {
              this.profileData = JSON.parse(profileJson);
              console.log("加载档案数据:", this.profileData);
              this.calculateCompletion();
            } else {
              console.log("未找到档案数据");
            }
          } catch (error) {
            console.error("加载档案数据失败:", error);
          }
        }

        calculateCompletion() {
          if (!this.profileData) {
            this.completionPercentage = 0;
            return;
          }

          const fields = [
            "name",
            "email",
            "phone",
            "education",
            "school",
            "major",
            "experience",
            "skills",
            "targetPosition",
            "targetSalary",
          ];

          let completedFields = 0;
          fields.forEach((field) => {
            if (
              this.profileData[field] &&
              this.profileData[field].toString().trim()
            ) {
              completedFields++;
            }
          });

          this.completionPercentage = Math.round(
            (completedFields / fields.length) * 100
          );
        }

        updateUI() {
          const profileSummary = document.getElementById("profileSummary");
          const profileContent = document.getElementById("profileContent");
          const completionFill = document.getElementById("completionFill");
          const completionText = document.getElementById("completionText");

          if (this.profileData) {
            profileSummary.style.display = "block";

            // 更新档案摘要内容
            profileContent.innerHTML = `
                        <p><strong>姓名:</strong> ${
                          this.profileData.name || "未填写"
                        }</p>
                        <p><strong>邮箱:</strong> ${
                          this.profileData.email || "未填写"
                        }</p>
                        <p><strong>学历:</strong> ${
                          this.profileData.education || "未填写"
                        }</p>
                        <p><strong>期望职位:</strong> ${
                          this.profileData.targetPosition || "未填写"
                        }</p>
                    `;

            // 更新完成度
            completionFill.style.width = this.completionPercentage + "%";
            completionText.textContent = `档案完成度: ${this.completionPercentage}%`;
          } else {
            profileSummary.style.display = "none";
          }
        }

        fillFormWithProfile() {
          if (!this.profileData) {
            console.log("没有档案数据，使用演示数据");
            return false;
          }

          console.log("使用档案数据填充表单");

          const fieldMapping = {
            name: "name",
            email: "email",
            phone: "phone",
            education: "education",
            school: "school",
            major: "major",
            experience: "experience",
            skills: "skills",
            targetPosition: "targetPosition",
            targetSalary: "targetSalary",
            targetCity: "targetCity",
          };

          Object.keys(fieldMapping).forEach((formField) => {
            const profileField = fieldMapping[formField];
            const element = document.getElementById(formField);

            if (element && this.profileData[profileField]) {
              element.value = this.profileData[profileField];
              this.highlightField(element);
            }
          });

          return true;
        }

        highlightField(element) {
          element.classList.add("highlight-field");
          setTimeout(() => {
            element.classList.remove("highlight-field");
          }, 1000);
        }

        clearDemoForm() {
          const form = document.getElementById("job-application-form");
          const inputs = form.querySelectorAll("input, select, textarea");

          inputs.forEach((input) => {
            input.value = "";
            input.style.background = "";
            input.style.borderColor = "";
          });
        }

        async recheckPlugin() {
          await this.checkPluginStatus();
          await this.loadProfileData();
          this.updateUI();
        }

        performDemoFilling() {
          console.log("执行演示填写");

          const demoData = {
            name: "张三",
            email: "zhangsan@example.com",
            phone: "13800138000",
            education: "本科",
            graduationYear: "2022",
            school: "清华大学",
            major: "计算机科学与技术",
            experience: "1-3年",
            currentCompany: "阿里巴巴",
            targetPosition: "前端开发工程师",
            targetSalary: "15k-20k",
            targetCity: "深圳",
            skills: "JavaScript, React, Vue, Node.js",
            projectExperience:
              "负责开发多个大型前端项目，包括电商平台、管理系统等，熟练使用React和Vue框架。",
            selfIntroduction:
              "我是一名热爱前端开发的工程师，具有3年的开发经验，熟练掌握现代前端技术栈。",
          };

          Object.keys(demoData).forEach((key) => {
            const field = document.getElementById(key);
            if (field) {
              setTimeout(() => {
                field.value = demoData[key];
                this.highlightField(field);
              }, Math.random() * 2000);
            }
          });
        }
      }

      // 扩展检测相关函数
      async function detectExtension() {
        try {
          const handshakeData = {
            type: "SJ_DETECT_V1",
            source: "jiancareer-tutorial",
            timestamp: Date.now(),
            data: {
              page: "tutorial-simulation",
              version: "1.0.0",
              capabilities: ["form-filling", "demo-interaction"],
            },
          };

          console.log("发送扩展检测信号:", handshakeData);
          window.postMessage(handshakeData, "*");

          setTimeout(() => {
            if (!extensionDetected) {
              updateExtensionStatus("error", "未检测到扩展");
              console.log("扩展检测超时");
            }
          }, 5000);
        } catch (error) {
          console.error("扩展检测失败:", error);
          updateExtensionStatus("error", "检测失败");
        }
      }

      function updateExtensionStatus(status, message) {
        const indicator = document.getElementById("extension-status");
        if (!indicator) return;

        switch (status) {
          case "connected":
            indicator.style.background = "#52c41a";
            indicator.style.borderColor = "#389e0d";
            indicator.textContent = "✅ " + message;
            break;
          case "error":
            indicator.style.background = "#ff4d4f";
            indicator.style.borderColor = "#cf1322";
            indicator.textContent = "❌ " + message;
            break;
          case "ready":
            indicator.style.background = "#1890ff";
            indicator.style.borderColor = "#096dd9";
            indicator.textContent = "🚀 " + message;
            break;
        }
      }

      function handleExtensionMessage(event) {
        const { data } = event;

        if (!data || typeof data !== "object") return;

        console.log("收到消息:", data);

        switch (data.type) {
          case "SJ_ACK_V1":
            extensionDetected = true;
            updateExtensionStatus("connected", "扩展已连接");
            setTimeout(() => {
              updateExtensionStatus("ready", "准备演示");
            }, 1000);
            break;
          case "SJ_DEMO_REQUEST":
            if (data.action === "start-demo") {
              startFormFillingDemo();
            }
            break;
          case "JC_AUTOFILL":
            console.log("收到插件一键填入消息，触发演示填写功能");
            console.log("消息数据:", data);
            updateExtensionStatus("ready", "插件一键填入中...");
            startFormFillingDemo();
            break;
        }
      }

      // 开始表单填写演示
      function startFormFillingDemo() {
        console.log("开始表单填写演示");

        updateExtensionStatus("ready", "演示进行中...");

        // 首先尝试使用档案数据
        if (tutorialManager && tutorialManager.fillFormWithProfile()) {
          console.log("使用档案数据填充表单");
          updateExtensionStatus("ready", "档案数据填充完成");
        } else {
          console.log("使用演示数据填充表单");
          tutorialManager.performDemoFilling();
          updateExtensionStatus("ready", "演示数据填充完成");
        }

        // 向扩展发送演示信号
        const demoMessage = {
          type: "SJ_START_DEMO",
          source: "jiancareer-tutorial",
          timestamp: Date.now(),
          data: {
            action: "autofill-form",
            formId: "job-application-form",
          },
        };

        window.postMessage(demoMessage, "*");
      }

      // 全局函数
      function checkPluginStatus() {
        if (tutorialManager) {
          tutorialManager.recheckPlugin();
        }
      }

      function loadProfileData() {
        if (tutorialManager) {
          tutorialManager.loadProfileData();
          tutorialManager.updateUI();
        }
      }

      function clearDemoForm() {
        if (tutorialManager) {
          tutorialManager.clearDemoForm();
        }
      }

      // Chrome扩展消息监听器
      function handleChromeExtensionMessage(request, sender, sendResponse) {
        console.log("收到Chrome扩展消息:", request);
        console.log("发送者信息:", sender);

        if (request.type === "JC_AUTOFILL") {
          console.log("收到插件一键填入消息，触发演示填写功能");
          console.log("消息数据:", request);
          updateExtensionStatus("ready", "插件一键填入中...");

          // 触发演示填写功能
          startFormFillingDemo();

          // 发送响应给扩展
          sendResponse({
            ok: true,
            filledCount: 15,
            totalCount: 15,
            detail: "演示填写完成",
          });

          return true; // 保持消息通道开放
        }

        return false;
      }

      // 页面初始化
      document.addEventListener("DOMContentLoaded", function () {
        console.log("页面加载完成，开始初始化");

        // 初始化教程管理器
        tutorialManager = new TutorialManager();

        // 监听扩展消息（window.postMessage）
        window.addEventListener("message", handleExtensionMessage);

        // 监听Chrome扩展消息（chrome.runtime.onMessage）
        if (
          typeof chrome !== "undefined" &&
          chrome.runtime &&
          chrome.runtime.onMessage
        ) {
          console.log("注册Chrome扩展消息监听器");
          chrome.runtime.onMessage.addListener(handleChromeExtensionMessage);
        } else {
          console.log("Chrome扩展API不可用，使用模拟模式");
        }

        // 开始扩展检测
        detectExtension();

        // 表单提交处理
        document
          .getElementById("job-application-form")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            // 显示成功消息
            document.getElementById("success-message").style.display = "block";

            // 滚动到成功消息
            document
              .getElementById("success-message")
              .scrollIntoView({ behavior: "smooth" });

            // 3秒后隐藏表单
            setTimeout(() => {
              document.getElementById("job-application-form").style.display =
                "none";
            }, 3000);
          });
      });
    </script>
  </body>
</html>
