<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoFill Pro ç®€åŒ–æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .form-section h3 {
            margin-top: 0;
            color: #495057;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        .status-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 300px;
            z-index: 1000;
        }
        .status-item {
            margin-bottom: 8px;
            font-size: 14px;
        }
        .status-ok { color: #28a745; }
        .status-error { color: #dc3545; }
        .status-pending { color: #ffc107; }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ AutoFill Pro æ‰©å±•æµ‹è¯•</h1>
        
        <!-- çŠ¶æ€é¢æ¿ -->
        <div class="status-panel" id="statusPanel">
            <h4>ğŸ“Š æ‰©å±•çŠ¶æ€</h4>
            <div class="status-item" id="extensionStatus">â³ æ£€æµ‹æ‰©å±•ä¸­...</div>
            <div class="status-item" id="mappingStatus">â³ æ£€æµ‹å­—æ®µæ˜ å°„...</div>
            <div class="status-item" id="widgetStatus">â³ æ£€æµ‹æµ®çª—...</div>
            <div class="status-item" id="formStatus">â³ ç­‰å¾…è¡¨å•æ£€æµ‹...</div>
        </div>

        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="form-section">
            <h3>ğŸ® æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
            <button class="test-button" onclick="testExtensionStatus()">æ£€æµ‹æ‰©å±•çŠ¶æ€</button>
            <button class="test-button" onclick="testFieldMapping()">æµ‹è¯•å­—æ®µæ˜ å°„</button>
            <button class="test-button" onclick="testHandshake()">æµ‹è¯•æ¡æ‰‹åè®®</button>
            <button class="test-button" onclick="testStorage()">æµ‹è¯•ç»Ÿä¸€é”®ä½</button>
        </div>

        <!-- åŸºæœ¬ä¿¡æ¯è¡¨å• -->
        <div class="form-section">
            <h3>ğŸ‘¤ åŸºæœ¬ä¿¡æ¯</h3>
            <div class="form-group">
                <label for="firstName">å§“å (First Name)</label>
                <input type="text" id="firstName" name="firstName" placeholder="è¯·è¾“å…¥å§“å">
            </div>
            <div class="form-group">
                <label for="lastName">å§“æ° (Last Name)</label>
                <input type="text" id="lastName" name="lastName" placeholder="è¯·è¾“å…¥å§“æ°">
            </div>
            <div class="form-group">
                <label for="email">é‚®ç®± (Email)</label>
                <input type="email" id="email" name="email" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€">
            </div>
            <div class="form-group">
                <label for="phone">æ‰‹æœºå·ç </label>
                <input type="tel" id="phone" name="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ">
            </div>
        </div>

        <!-- è”ç³»æ–¹å¼ -->
        <div class="form-section">
            <h3>ğŸ“± è”ç³»æ–¹å¼</h3>
            <div class="form-group">
                <label for="wechat">å¾®ä¿¡å·</label>
                <input type="text" id="wechat" name="wechat" placeholder="è¯·è¾“å…¥å¾®ä¿¡å·">
            </div>
            <div class="form-group">
                <label for="qq">QQå·ç </label>
                <input type="text" id="qq" name="qq" placeholder="è¯·è¾“å…¥QQå·ç ">
            </div>
            <div class="form-group">
                <label for="linkedin">LinkedIn</label>
                <input type="text" id="linkedin" name="linkedin" placeholder="è¯·è¾“å…¥LinkedIné“¾æ¥">
            </div>
        </div>

        <!-- æµ‹è¯•å­—æ®µ -->
        <div class="form-section">
            <h3>ğŸ§ª æµ‹è¯•å­—æ®µ</h3>
            <div class="form-group">
                <label for="testField">æµ‹è¯•å­—æ®µ (ç”¨äºéªŒè¯çƒ­æ”¹åŠŸèƒ½)</label>
                <input type="text" id="testField" name="testField" placeholder="è¿™æ˜¯æµ‹è¯•å­—æ®µ">
            </div>
        </div>
    </div>

    <script>
        // æ‰©å±•çŠ¶æ€æ£€æµ‹
        function updateStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            element.className = `status-item status-${status}`;
            element.textContent = message;
        }

        // æ£€æµ‹æ‰©å±•æ˜¯å¦åŠ è½½
        function testExtensionStatus() {
            console.log('ğŸ” å¼€å§‹æ£€æµ‹æ‰©å±•çŠ¶æ€...');
            
            // æ£€æµ‹ Chrome æ‰©å±• API
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                updateStatus('extensionStatus', 'ok', 'âœ… Chrome æ‰©å±• API å¯ç”¨');
                
                // å°è¯•å‘é€æ¶ˆæ¯æµ‹è¯•æ‰©å±•è¿æ¥
                chrome.runtime.sendMessage({type: 'PING'}, (response) => {
                    if (chrome.runtime.lastError) {
                        updateStatus('extensionStatus', 'error', 'âŒ æ‰©å±•æœªå“åº”');
                        console.error('æ‰©å±•è¿æ¥å¤±è´¥:', chrome.runtime.lastError);
                    } else {
                        updateStatus('extensionStatus', 'ok', 'âœ… æ‰©å±•è¿æ¥æ­£å¸¸');
                        console.log('âœ… æ‰©å±•å“åº”:', response);
                    }
                });
            } else {
                updateStatus('extensionStatus', 'error', 'âŒ Chrome æ‰©å±• API ä¸å¯ç”¨');
                console.error('âŒ Chrome æ‰©å±•ç¯å¢ƒæœªæ£€æµ‹åˆ°');
            }
        }

        // æµ‹è¯•å­—æ®µæ˜ å°„
        function testFieldMapping() {
            console.log('ğŸ” å¼€å§‹æµ‹è¯•å­—æ®µæ˜ å°„...');
            
            if (window.__SJ_FIELD_MAPPINGS__) {
                updateStatus('mappingStatus', 'ok', 'âœ… å­—æ®µæ˜ å°„å·²åŠ è½½');
                console.log('âœ… å­—æ®µæ˜ å°„å¯¹è±¡:', window.__SJ_FIELD_MAPPINGS__);
                console.log('ğŸ“Š æ˜ å°„å­—æ®µæ•°é‡:', Object.keys(window.__SJ_FIELD_MAPPINGS__).length);
                
                // æµ‹è¯•ç‰¹å®šå­—æ®µ
                const testFields = ['firstName', 'email', 'phone', 'wechat', 'testField'];
                testFields.forEach(field => {
                    if (window.__SJ_FIELD_MAPPINGS__[field]) {
                        console.log(`âœ… ${field} å­—æ®µæ˜ å°„å­˜åœ¨:`, window.__SJ_FIELD_MAPPINGS__[field]);
                    } else {
                        console.warn(`âš ï¸ ${field} å­—æ®µæ˜ å°„ç¼ºå¤±`);
                    }
                });
            } else {
                updateStatus('mappingStatus', 'error', 'âŒ å­—æ®µæ˜ å°„æœªåŠ è½½');
                console.error('âŒ window.__SJ_FIELD_MAPPINGS__ æœªæ‰¾åˆ°');
            }
        }

        // æµ‹è¯•æ¡æ‰‹åè®®
        function testHandshake() {
            console.log('ğŸ” å¼€å§‹æµ‹è¯•æ¡æ‰‹åè®®...');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                // æµ‹è¯•è·å–ç”¨æˆ·æ¡£æ¡ˆ
                chrome.runtime.sendMessage({type: 'GET_SJ_PROFILE'}, (response) => {
                    if (chrome.runtime.lastError) {
                        console.error('âŒ æ¡æ‰‹åè®®å¤±è´¥:', chrome.runtime.lastError);
                    } else {
                        console.log('âœ… æ¡æ‰‹åè®®å“åº” (GET_SJ_PROFILE):', response);
                    }
                });
                
                // æµ‹è¯•è·å–æŠ•é€’è®°å½•
                chrome.runtime.sendMessage({type: 'GET_SJ_APPLICATIONS'}, (response) => {
                    if (chrome.runtime.lastError) {
                        console.error('âŒ è·å–æŠ•é€’è®°å½•å¤±è´¥:', chrome.runtime.lastError);
                    } else {
                        console.log('âœ… æŠ•é€’è®°å½•å“åº” (GET_SJ_APPLICATIONS):', response);
                    }
                });
            } else {
                console.error('âŒ Chrome æ‰©å±• API ä¸å¯ç”¨ï¼Œæ— æ³•æµ‹è¯•æ¡æ‰‹åè®®');
            }
        }

        // æµ‹è¯•ç»Ÿä¸€é”®ä½å­˜å‚¨
        function testStorage() {
            console.log('ğŸ” å¼€å§‹æµ‹è¯•ç»Ÿä¸€é”®ä½å­˜å‚¨...');
            
            if (typeof chrome !== 'undefined' && chrome.storage) {
                chrome.storage.local.get(['sj_profile', 'sj_applications'], (result) => {
                    console.log('âœ… ç»Ÿä¸€é”®ä½æ•°æ®:', result);
                    
                    if (result.sj_profile) {
                        console.log('âœ… sj_profile æ•°æ®å­˜åœ¨:', result.sj_profile);
                    } else {
                        console.log('â„¹ï¸ sj_profile æ•°æ®ä¸ºç©ºæˆ–ä¸å­˜åœ¨');
                    }
                    
                    if (result.sj_applications) {
                        console.log('âœ… sj_applications æ•°æ®å­˜åœ¨:', result.sj_applications);
                    } else {
                        console.log('â„¹ï¸ sj_applications æ•°æ®ä¸ºç©ºæˆ–ä¸å­˜åœ¨');
                    }
                });
            } else {
                console.error('âŒ Chrome å­˜å‚¨ API ä¸å¯ç”¨');
            }
        }

        // æ£€æµ‹æµ®çª—
        function checkWidget() {
            const widget = document.getElementById('sj-autofill-tutor');
            if (widget) {
                updateStatus('widgetStatus', 'ok', 'âœ… æµ®çª—å·²æ˜¾ç¤º');
                console.log('âœ… AutoFill Pro æµ®çª—å·²æ‰¾åˆ°:', widget);
            } else {
                updateStatus('widgetStatus', 'pending', 'â³ æµ®çª—æœªæ£€æµ‹åˆ°');
                console.log('â³ AutoFill Pro æµ®çª—æœªæ‰¾åˆ°ï¼Œå¯èƒ½è¿˜åœ¨åŠ è½½ä¸­...');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æ£€æµ‹
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ AutoFill Pro æµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // å»¶è¿Ÿæ£€æµ‹ï¼Œç»™æ‰©å±•æ—¶é—´åŠ è½½
            setTimeout(() => {
                testExtensionStatus();
                testFieldMapping();
                checkWidget();
            }, 1000);
            
            // å®šæœŸæ£€æŸ¥æµ®çª—çŠ¶æ€
            setInterval(checkWidget, 2000);
        });

        // ç›‘å¬æ¥è‡ªæ‰©å±•çš„æ¶ˆæ¯
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
                console.log('ğŸ“¨ æ”¶åˆ°æ‰©å±•æ¶ˆæ¯:', message);
                
                if (message.type === 'FORMS_DETECTED') {
                    updateStatus('formStatus', 'ok', `âœ… æ£€æµ‹åˆ° ${message.count} ä¸ªè¡¨å•`);
                } else if (message.type === 'FORM_FILLED') {
                    console.log('âœ… è¡¨å•å¡«å……å®Œæˆ:', message);
                }
                
                sendResponse({status: 'received'});
            });
        }
    </script>
</body>
</html>